<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance AI Arena - BNB/USDT Trading Championship</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="description" content="Binance AI Arena - 4个顶级AI模型在BNB/USDT市场进行1x杠杆合约交易对决">
    <meta name="keywords" content="Binance, AI, Trading, Arena, BNB, USDT, Claude, GPT, Grok, DeepSeek">
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Arial, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(90deg, #1a1a1a 0%, #2a2a2a 100%);
            border-bottom: 2px solid #00ff88;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #F0B90B, #FCD535);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.2) 50%, transparent 70%);
            animation: logoShine 3s infinite;
        }

        .logo-icon img {
            transition: transform 0.3s ease;
        }

        .logo-icon:hover img {
            transform: scale(1.1);
        }

        @keyframes logoShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .logo-text {
            display: flex;
            flex-direction: column;
            line-height: 1.1;
        }

        .logo-main {
            font-size: 20px;
            font-weight: 900;
            background: linear-gradient(135deg, #F0B90B, #FCD535);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-sub {
            font-size: 10px;
            color: #888;
            font-weight: 500;
            text-transform: none;
            letter-spacing: 0.5px;
        }

        .live-indicator {
            width: 12px;
            height: 12px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.6;
                transform: scale(1.2);
            }
        }

        .info-banner {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 200, 100, 0.05));
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            padding: 20px 30px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .info-icon {
            font-size: 48px;
            flex-shrink: 0;
        }

        .info-content {
            flex: 1;
        }

        .info-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #00ff88;
        }

        .info-description {
            font-size: 14px;
            color: #ccc;
            line-height: 1.6;
        }

        .info-strategies {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 12px;
        }

        .info-note {
            margin-top: 8px;
            font-size: 11px;
            color: #666;
            font-style: italic;
        }

        .strategy-tag {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            text-align: center;
        }

        .strategy-tag strong {
            color: #00ff88;
            display: block;
            margin-bottom: 4px;
        }

        .control-panel {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid #333;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            color: #fff;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .control-btn:hover {
            background: linear-gradient(135deg, #2a2a2a, #3a3a3a);
            border-color: #00ff88;
            transform: translateY(-2px);
        }

        .control-btn.active {
            background: linear-gradient(135deg, #00ff88, #00cc77);
            color: #000;
        }

        .control-btn.danger {
            border-color: #ff4757;
        }

        .control-btn.danger:hover {
            background: linear-gradient(135deg, #ff4757, #ff6b6b);
        }

        .save-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 6px;
            font-size: 12px;
            color: #00ff88;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .header-info {
            display: flex;
            gap: 40px;
        }

        .header-item {
            text-align: center;
        }

        .header-label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .header-value {
            font-size: 20px;
            font-weight: bold;
            margin-top: 4px;
        }

        .price-up { color: #00ff88; }
        .price-down { color: #ff4757; }

        .main-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
        }

        .ai-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            height: 450px;
        }

        .ai-panel {
            background: linear-gradient(145deg, #1a1a1a 0%, #252525 100%);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .ai-panel:hover {
            transform: translateY(-5px);
        }

        .ai-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-color) 0%, transparent 100%);
        }

        .ai-panel.gpt { --accent-color: #00ff88; }
        .ai-panel.deepseek { --accent-color: #ff6b6b; }
        .ai-panel.grok { --accent-color: #4ecdc4; }
        .ai-panel.claude { --accent-color: #a8e6cf; }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .ai-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: var(--accent-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        .ai-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .ai-info {
            flex: 1;
        }

        .ai-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .ai-style {
            font-size: 12px;
            color: #888;
        }

        .pnl-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            text-align: center;
        }

        .pnl-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .pnl-value {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: -0.5px;
        }

        .position-pnl {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 12px;
            border-left: 3px solid #888;
        }

        .position-pnl.long {
            border-left-color: #00ff88;
        }

        .position-pnl.short {
            border-left-color: #ff6b6b;
        }

        .position-label {
            font-size: 10px;
            color: #888;
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .position-value {
            font-size: 18px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .position-direction {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
        }

        .position-direction.long {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .position-direction.short {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        .profit { color: #00ff88; }
        .loss { color: #ff4757; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.03);
            padding: 8px 10px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-label {
            font-size: 11px;
            color: #888;
        }

        .stat-value {
            font-size: 12px;
            font-weight: 600;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .stat-value img {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .trade-history {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 11px;
            position: relative;
        }

        .trade-history::-webkit-scrollbar {
            width: 4px;
        }

        .trade-history::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 2px;
        }

        .trade-history::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
        }

        .trade-history::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .trade-item {
            padding: 8px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border-left: 4px solid #888;
            transition: all 0.3s ease;
            position: relative;
        }

        .trade-item:last-child {
            margin-bottom: 0;
        }

        .trade-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(2px);
        }

        .trade-item.buy-trade {
            border-left-color: #00ff88;
            background: rgba(0, 255, 136, 0.05);
        }

        .trade-item.buy-trade:hover {
            background: rgba(0, 255, 136, 0.1);
        }

        .trade-item.sell-trade {
            border-left-color: #ff4757;
            background: rgba(255, 71, 87, 0.05);
        }

        .trade-item.sell-trade:hover {
            background: rgba(255, 71, 87, 0.1);
        }

        .trade-time {
            color: #888;
            margin-bottom: 4px;
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trade-info {
            color: #e6e6e6;
            line-height: 1.5;
            font-size: 11px;
        }

        .trade-info strong {
            color: #fff;
            font-weight: 600;
        }

        .trade-history-title {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
            padding-bottom: 3px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .market-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            flex: 1;
        }

        .chart-panel {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: bold;
        }

        .chart-price {
            text-align: right;
        }

        .price-main {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .price-change {
            font-size: 16px;
        }

        #tradingview_chart {
            flex: 1;
            border-radius: 8px;
            overflow: hidden;
            min-height: 400px;
        }

        .market-data {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .data-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
        }

        .data-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .indicator-grid {
            display: grid;
            gap: 12px;
        }

        .indicator-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
        }

        .indicator-name {
            font-size: 12px;
            color: #888;
        }

        .indicator-value {
            font-size: 14px;
            font-weight: bold;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
            margin-bottom: 8px;
            transition: all 0.3s;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .rank {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .rank.gold { background: linear-gradient(135deg, #FFD700, #FFA500); }
        .rank.silver { background: linear-gradient(135deg, #C0C0C0, #808080); }
        .rank.bronze { background: linear-gradient(135deg, #CD7F32, #8B4513); }

        .leader-name {
            flex: 1;
            font-size: 13px;
        }

        .leader-pnl {
            font-size: 14px;
            font-weight: bold;
        }

        .footer-stats {
            background: #1a1a1a;
            border-top: 2px solid #333;
            padding: 20px;
            display: flex;
            justify-content: space-around;
        }

        .footer-stat {
            text-align: center;
        }

        .footer-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .footer-value {
            font-size: 18px;
            font-weight: bold;
        }

        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.9), rgba(0, 200, 100, 0.9));
            border: 1px solid #00ff88;
            border-radius: 8px;
            color: #000;
            font-weight: 500;
            font-size: 14px;
            display: none;
            animation: slideIn 0.3s ease;
            z-index: 1000;
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.3);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 1400px) {
            .ai-container {
                grid-template-columns: repeat(2, 1fr);
                height: auto;
            }
            .market-container {
                grid-template-columns: 1fr;
            }
            .info-strategies {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .ai-container {
                grid-template-columns: 1fr;
            }
            .header-info {
                display: none;
            }
            .control-panel {
                flex-direction: column;
                gap: 10px;
            }
            .info-banner {
                flex-direction: column;
                text-align: center;
            }
            .info-icon {
                font-size: 36px;
            }
            .info-strategies {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <div class="logo-icon">
                <img src="logo.png" alt="Binance AI Arena" style="width: 100%; height: 100%; object-fit: contain;">
            </div>
            <div class="logo-text">
                <div class="logo-main">BAA</div>
                <div class="logo-sub">Binance AI Arena</div>
            </div>
            <span class="live-indicator"></span>
        </div>
        <div class="control-panel">
            <div class="save-status">
                <span class="status-dot"></span>
                <span id="save-status">数据自动保存中</span>
            </div>
            <div class="control-buttons">
                <button class="control-btn" id="pauseBtn" onclick="togglePause()">
                    <span>⏸️</span> 暂停
                </button>
                <button class="control-btn" onclick="exportData()">
                    <span>💾</span> 导出
                </button>
                <button class="control-btn" onclick="importData()">
                    <span>📂</span> 导入
                </button>
                <button class="control-btn danger" onclick="resetData()">
                    <span>🔄</span> 重置
                </button>
            </div>
        </div>
        <div class="header-info">
            <div class="header-item">
                <div class="header-label">BNB/USDT</div>
                <div class="header-value price-up" id="header-price">$0.00</div>
            </div>
            <div class="header-item">
                <div class="header-label">24h Change</div>
                <div class="header-value price-up" id="header-change">+0.00%</div>
            </div>
            <div class="header-item">
                <div class="header-label">运行时间</div>
                <div class="header-value" id="header-runtime">00:00:00</div>
            </div>
        </div>
    </div>

    <div class="main-wrapper">
        <div class="info-banner">
            <div class="info-icon">
                <img src="logo.png" alt="BAA Logo" style="width: 48px; height: 48px; object-fit: contain;">
            </div>
            <div class="info-content">
                <div class="info-title">Binance AI Arena - BNB/USDT Trading Championship</div>
                <div class="info-description">
                    4个顶级AI模型：<strong>Claude 4.5 vs Grok 4 vs GPT-4.0 vs DeepSeek</strong>，在真实BNB/USDT市场中进行<strong>1x杠杆合约交易</strong>对决。每个AI从<strong>100 BNB</strong>起步，可做多做空，看谁的策略能获得最高收益！
                    <div class="info-note">💾 数据自动保存在您的浏览器本地，每个浏览器独立运行，互不影响</div>
                </div>
                <div class="info-strategies">
                    <div class="strategy-tag">
                        <strong><img src="gpt.jpg" style="width:20px;height:20px;border-radius:50%;vertical-align:middle;margin-right:5px;" onerror="this.style.display='none'; this.parentElement.innerHTML='🤖 GPT-4.0';" alt="GPT-4.0"> GPT-4.0</strong>
                        保守稳健 | 低风险低频
                    </div>
                    <div class="strategy-tag">
                        <strong><img src="deepseek.jpg" style="width:20px;height:20px;border-radius:50%;vertical-align:middle;margin-right:5px;" onerror="this.style.display='none'; this.parentElement.innerHTML='⚡ DeepSeek';" alt="DeepSeek"> DeepSeek</strong>
                        激进投机 | 高风险高频
                    </div>
                    <div class="strategy-tag">
                        <strong><img src="grok.jpg" style="width:20px;height:20px;border-radius:50%;vertical-align:middle;margin-right:5px;" onerror="this.style.display='none'; this.parentElement.innerHTML='🎯 Grok 4';" alt="Grok 4"> Grok 4</strong>
                        逆向交易 | 反市场情绪
                    </div>
                    <div class="strategy-tag">
                        <strong><img src="claud.jpg" style="width:20px;height:20px;border-radius:50%;vertical-align:middle;margin-right:5px;" onerror="this.style.display='none'; this.parentElement.innerHTML='📊 Claude 4.5';" alt="Claude 4.5"> Claude 4.5</strong>
                        价值投资 | 均价回归
                    </div>
                </div>
            </div>
        </div>

        <div class="ai-container">
            <div class="ai-panel gpt">
                <div class="ai-header">
                    <div class="ai-icon">
                        <img src="gpt.jpg" alt="GPT-4" onerror="this.style.display='none'; this.parentElement.innerHTML='🤖';">
                    </div>
                    <div class="ai-info">
                        <div class="ai-name">GPT-4.0</div>
                        <div class="ai-style">保守稳健型</div>
                    </div>
                </div>
                <div class="pnl-box">
                    <div class="pnl-label">总收益率</div>
                    <div class="pnl-value profit" id="gpt-pnl">+0.00%</div>
                </div>
                <div class="position-pnl" id="gpt-position-pnl" style="display: none;">
                    <div class="position-label">持仓盈亏</div>
                    <div class="position-value">
                        <span id="gpt-unrealized-pnl">+0.00 BNB</span>
                        <span class="position-direction" id="gpt-direction">无持仓</span>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat">
                        <span class="stat-label">余额</span>
                        <span class="stat-value">
                            <img src="bnb.jpg" alt="BNB" onerror="this.style.display='none';">
                            <span id="gpt-balance">100.0000</span> BNB
                        </span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">持仓</span>
                        <span class="stat-value">
                            <img src="bnb.jpg" alt="BNB" onerror="this.style.display='none';">
                            <span id="gpt-position">0.0000</span> BNB
                        </span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">交易</span>
                        <span class="stat-value" id="gpt-trades">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">胜率</span>
                        <span class="stat-value" id="gpt-winrate">0%</span>
                    </div>
                </div>
                <div class="trade-history" id="gpt-history">
                    <div style="text-align: center; color: #666; padding: 20px 0;">等待交易信号...</div>
                </div>
            </div>

            <div class="ai-panel deepseek">
                <div class="ai-header">
                    <div class="ai-icon">
                        <img src="deepseek.jpg" alt="DeepSeek V3" onerror="this.style.display='none'; this.parentElement.innerHTML='⚡';">
                    </div>
                    <div class="ai-info">
                        <div class="ai-name">DeepSeek V3</div>
                        <div class="ai-style">激进投机型</div>
                    </div>
                </div>
                <div class="pnl-box">
                    <div class="pnl-label">总收益率</div>
                    <div class="pnl-value profit" id="deepseek-pnl">+0.00%</div>
                </div>
                <div class="position-pnl" id="deepseek-position-pnl" style="display: none;">
                    <div class="position-label">持仓盈亏</div>
                    <div class="position-value">
                        <span id="deepseek-unrealized-pnl">+0.00 BNB</span>
                        <span class="position-direction" id="deepseek-direction">无持仓</span>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat">
                        <span class="stat-label">余额</span>
                        <span class="stat-value">
                            <img src="bnb.jpg" alt="BNB" onerror="this.style.display='none';">
                            <span id="deepseek-balance">100.0000</span> BNB
                        </span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">持仓</span>
                        <span class="stat-value">
                            <img src="bnb.jpg" alt="BNB" onerror="this.style.display='none';">
                            <span id="deepseek-position">0.0000</span> BNB
                        </span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">交易</span>
                        <span class="stat-value" id="deepseek-trades">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">胜率</span>
                        <span class="stat-value" id="deepseek-winrate">0%</span>
                    </div>
                </div>
                <div class="trade-history" id="deepseek-history">
                    <div style="text-align: center; color: #666; padding: 20px 0;">等待交易信号...</div>
                </div>
            </div>

            <div class="ai-panel grok">
                <div class="ai-header">
                    <div class="ai-icon">
                        <img src="grok.jpg" alt="Grok 4" onerror="this.style.display='none'; this.parentElement.innerHTML='🎯';">
                    </div>
                    <div class="ai-info">
                        <div class="ai-name">Grok 4</div>
                        <div class="ai-style">逆向交易型</div>
                    </div>
                </div>
                <div class="pnl-box">
                    <div class="pnl-label">总收益率</div>
                    <div class="pnl-value profit" id="grok-pnl">+0.00%</div>
                </div>
                <div class="position-pnl" id="grok-position-pnl" style="display: none;">
                    <div class="position-label">持仓盈亏</div>
                    <div class="position-value">
                        <span id="grok-unrealized-pnl">+0.00 BNB</span>
                        <span class="position-direction" id="grok-direction">无持仓</span>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat">
                        <span class="stat-label">余额</span>
                        <span class="stat-value">
                            <img src="bnb.jpg" alt="BNB" onerror="this.style.display='none';">
                            <span id="grok-balance">100.0000</span> BNB
                        </span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">持仓</span>
                        <span class="stat-value">
                            <img src="bnb.jpg" alt="BNB" onerror="this.style.display='none';">
                            <span id="grok-position">0.0000</span> BNB
                        </span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">交易</span>
                        <span class="stat-value" id="grok-trades">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">胜率</span>
                        <span class="stat-value" id="grok-winrate">0%</span>
                    </div>
                </div>
                <div class="trade-history" id="grok-history">
                    <div style="text-align: center; color: #666; padding: 20px 0;">等待交易信号...</div>
                </div>
            </div>

            <div class="ai-panel claude">
                <div class="ai-header">
                    <div class="ai-icon">
                        <img src="claud.jpg" alt="Claude 4.5" onerror="this.style.display='none'; this.parentElement.innerHTML='📊';">
                    </div>
                    <div class="ai-info">
                        <div class="ai-name">Claude 4.5</div>
                        <div class="ai-style">价值投资型</div>
                    </div>
                </div>
                <div class="pnl-box">
                    <div class="pnl-label">总收益率</div>
                    <div class="pnl-value profit" id="claude-pnl">+0.00%</div>
                </div>
                <div class="position-pnl" id="claude-position-pnl" style="display: none;">
                    <div class="position-label">持仓盈亏</div>
                    <div class="position-value">
                        <span id="claude-unrealized-pnl">+0.00 BNB</span>
                        <span class="position-direction" id="claude-direction">无持仓</span>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat">
                        <span class="stat-label">余额</span>
                        <span class="stat-value">
                            <img src="bnb.jpg" alt="BNB" onerror="this.style.display='none';">
                            <span id="claude-balance">100.0000</span> BNB
                        </span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">持仓</span>
                        <span class="stat-value">
                            <img src="bnb.jpg" alt="BNB" onerror="this.style.display='none';">
                            <span id="claude-position">0.0000</span> BNB
                        </span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">交易</span>
                        <span class="stat-value" id="claude-trades">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">胜率</span>
                        <span class="stat-value" id="claude-winrate">0%</span>
                    </div>
                </div>
                <div class="trade-history" id="claude-history">
                    <div style="text-align: center; color: #666; padding: 20px 0;">等待交易信号...</div>
                </div>
            </div>
        </div>

        <div class="market-container">
            <div class="chart-panel">
                <div class="chart-header">
                    <div class="chart-title">
                    <img src="logo.png" alt="BAA" style="width: 24px; height: 24px; object-fit: contain; vertical-align: middle; margin-right: 8px;">
                    BNB/USDT 实时图表
                </div>
                    <div class="chart-price">
                        <div class="price-main" id="chart-price">$0.00</div>
                        <div class="price-change price-up" id="chart-change">+0.00%</div>
                    </div>
                </div>
                <div id="tradingview_chart"></div>
            </div>

            <div class="market-data">
                <div class="data-card">
                    <div class="data-title">技术指标</div>
                    <div class="indicator-grid">
                        <div class="indicator-item">
                            <span class="indicator-name">RSI(14)</span>
                            <span class="indicator-value" id="rsi">50</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-name">MACD</span>
                            <span class="indicator-value" id="macd">0.00</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-name">波动率</span>
                            <span class="indicator-value" id="volatility">0.0%</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-name">成交量</span>
                            <span class="indicator-value" id="volume">0</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-name">市场情绪</span>
                            <span class="indicator-value" id="sentiment">中性</span>
                        </div>
                    </div>
                </div>

                <div class="data-card">
                    <div class="data-title">AI排行榜</div>
                    <div id="leaderboard"></div>
                </div>

                <div class="data-card">
                    <div class="data-title">交易统计</div>
                    <div class="indicator-grid">
                        <div class="indicator-item">
                            <span class="indicator-name">总交易次数</span>
                            <span class="indicator-value" id="stat-trades">0</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-name">平均收益率</span>
                            <span class="indicator-value" id="stat-avg">0.00%</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-name">最高收益</span>
                            <span class="indicator-value" id="stat-max">0.00%</span>
                        </div>
                        <div class="indicator-item">
                            <span class="indicator-name">总成交量</span>
                            <span class="indicator-value" id="stat-volume">0 BNB</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer-stats">
        <div class="footer-stat">
            <div class="footer-label">数据已保存</div>
            <div class="footer-value" id="save-count">0</div>
        </div>
        <div class="footer-stat">
            <div class="footer-label">会话时长</div>
            <div class="footer-value" id="session-time">00:00:00</div>
        </div>
        <div class="footer-stat">
            <div class="footer-label">最后保存</div>
            <div class="footer-value" id="last-save">-</div>
        </div>
        <div class="footer-stat">
            <div class="footer-label">数据版本</div>
            <div class="footer-value">v2.3</div>
        </div>
        <div class="footer-stat">
            <div class="footer-label">Powered by</div>
            <div class="footer-value">
                <img src="logo.png" alt="BAA" style="width: 20px; height: 20px; object-fit: contain; vertical-align: middle;">
                <span style="margin-left: 5px;">BAA</span>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>
    <input type="file" id="fileInput" accept=".json" style="display: none;">

    <script>
        const CONFIG = {
            STORAGE_KEY: 'ai_trading_arena_data_v2.3',
            INITIAL_BALANCE: 100,
            PRICE_UPDATE_INTERVAL: 3000,
            TRADE_INTERVAL: 2000,
            AUTO_SAVE_INTERVAL: 30000
        };

        let currentPrice = 600;
        let initialPrice = 600;
        let priceHistory = [];
        let startTime = Date.now();
        let isPaused = false;
        let saveCount = 0;
        let lastSaveTime = null;
        let isInitialPhase = true;
        let initialTradeCount = 0;

        let traders = {
            gpt: {
                name: 'GPT-4.0',
                bnbBalance: CONFIG.INITIAL_BALANCE,  // 可用BNB余额
                positionBNB: 0,  // 持仓数量（BNB，正=多头，负=空头）
                entryPrice: 0,  // 开仓均价
                trades: 0,
                wins: 0,
                losses: 0,
                lastTrade: null,
                tradeHistory: [],
                totalVolume: 0,
                style: 'conservative',
                riskLevel: 0.3,
                tradeFreq: 0.7
            },
            deepseek: {
                name: 'DeepSeek V3',
                bnbBalance: CONFIG.INITIAL_BALANCE,
                positionBNB: 0,
                entryPrice: 0,
                trades: 0,
                wins: 0,
                losses: 0,
                lastTrade: null,
                tradeHistory: [],
                totalVolume: 0,
                style: 'aggressive',
                riskLevel: 0.8,
                tradeFreq: 0.9
            },
            grok: {
                name: 'Grok 4',
                bnbBalance: CONFIG.INITIAL_BALANCE,
                positionBNB: 0,
                entryPrice: 0,
                trades: 0,
                wins: 0,
                losses: 0,
                lastTrade: null,
                tradeHistory: [],
                totalVolume: 0,
                style: 'contrarian',
                riskLevel: 0.6,
                tradeFreq: 0.8
            },
            claude: {
                name: 'Claude 4.5',
                bnbBalance: CONFIG.INITIAL_BALANCE,
                positionBNB: 0,
                entryPrice: 0,
                trades: 0,
                wins: 0,
                losses: 0,
                lastTrade: null,
                tradeHistory: [],
                totalVolume: 0,
                style: 'value',
                riskLevel: 0.4,
                tradeFreq: 0.6
            }
        };

        let indicators = {
            rsi: 50,
            macd: 0,
            volatility: 1,
            volume: 1000000,
            trend: 'neutral'
        };

        function saveData() {
            try {
                const data = {
                    version: '2.3',
                    traders: traders,
                    priceHistory: priceHistory.slice(-50),
                    initialPrice: initialPrice,
                    currentPrice: currentPrice,
                    startTime: startTime,
                    saveTime: Date.now(),
                    saveCount: ++saveCount,
                    indicators: indicators
                };
                
                localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(data));
                lastSaveTime = new Date();
                
                document.getElementById('save-count').textContent = saveCount;
                document.getElementById('last-save').textContent = lastSaveTime.toLocaleTimeString('zh-CN');
                
                console.log('✅ 数据已保存 #' + saveCount);
            } catch (e) {
                // 静默失败，可能是localStorage被禁用或容量不足
                console.warn('⚠️ 数据保存失败:', e.message);
                // 不显示错误通知，避免打断用户体验
            }
        }

        function ensureSystemInitialized() {
            // 确保所有必要的变量都已初始化
            if (!traders) {
                console.warn('⚠️ 交易者数据未初始化，重新初始化...');
                // 重新初始化traders对象
                traders = {
                    gpt: {
                        name: 'GPT-4',
                        bnbBalance: CONFIG.INITIAL_BALANCE,
                        positionBNB: 0,
                        entryPrice: 0,
                        trades: 0,
                        wins: 0,
                        losses: 0,
                        lastTrade: null,
                        tradeHistory: [],
                        totalVolume: 0,
                        style: 'conservative',
                        riskLevel: 0.3,
                        tradeFreq: 0.7
                    },
                    deepseek: {
                        name: 'DeepSeek V3',
                        bnbBalance: CONFIG.INITIAL_BALANCE,
                        positionBNB: 0,
                        entryPrice: 0,
                        trades: 0,
                        wins: 0,
                        losses: 0,
                        lastTrade: null,
                        tradeHistory: [],
                        totalVolume: 0,
                        style: 'aggressive',
                        riskLevel: 0.8,
                        tradeFreq: 0.9
                    },
                    grok: {
                        name: 'Grok 4',
                        bnbBalance: CONFIG.INITIAL_BALANCE,
                        positionBNB: 0,
                        entryPrice: 0,
                        trades: 0,
                        wins: 0,
                        losses: 0,
                        lastTrade: null,
                        tradeHistory: [],
                        totalVolume: 0,
                        style: 'contrarian',
                        riskLevel: 0.6,
                        tradeFreq: 0.8
                    },
                    claude: {
                        name: 'Claude 4.5',
                        bnbBalance: CONFIG.INITIAL_BALANCE,
                        positionBNB: 0,
                        entryPrice: 0,
                        trades: 0,
                        wins: 0,
                        losses: 0,
                        lastTrade: null,
                        tradeHistory: [],
                        totalVolume: 0,
                        style: 'value',
                        riskLevel: 0.4,
                        tradeFreq: 0.6
                    }
                };
            }
            
            // 确保其他必要变量
            if (!priceHistory) priceHistory = [];
            if (!indicators) indicators = { rsi: 50, macd: 0, volatility: 1, volume: 1000000, trend: 'neutral' };
            if (currentPrice === undefined) currentPrice = 600;
            if (initialPrice === undefined) initialPrice = 600;
            if (startTime === undefined) startTime = Date.now();
            
            console.log('✅ 系统初始化检查完成');
        }

        function loadData() {
            try {
                const saved = localStorage.getItem(CONFIG.STORAGE_KEY);
                if (!saved) {
                    console.log('📝 未找到历史数据，将开始新的交易会话');
                    return false;
                }
                
                const data = JSON.parse(saved);
                
                // 确保数据结构完整
                if (!data.traders) {
                    console.warn('⚠️ 历史数据格式不完整，使用默认设置');
                    return false;
                }
                
                traders = data.traders;
                
                Object.keys(traders).forEach(id => {
                    // 兼容旧数据字段名
                    if (traders[id].usdBalance !== undefined) {
                        traders[id].bnbBalance = traders[id].usdBalance;
                        delete traders[id].usdBalance;
                    }
                    if (traders[id].bnbPosition !== undefined && traders[id].positionBNB === undefined) {
                        traders[id].positionBNB = traders[id].bnbPosition;
                        delete traders[id].bnbPosition;
                    }
                    if (traders[id].avgCost !== undefined && traders[id].entryPrice === undefined) {
                        traders[id].entryPrice = traders[id].avgCost;
                        delete traders[id].avgCost;
                    }
                    
                    if (!traders[id].tradeHistory) {
                        traders[id].tradeHistory = [];
                    }
                    if (traders[id].totalVolume === undefined) {
                        traders[id].totalVolume = 0;
                    }
                });
                
                priceHistory = data.priceHistory || [];
                initialPrice = data.initialPrice || 600;
                currentPrice = data.currentPrice || 600;
                startTime = data.startTime || Date.now();
                saveCount = data.saveCount || 0;
                indicators = data.indicators || indicators;
                
                const allTraded = Object.values(traders).every(t => t.trades > 0);
                if (allTraded) {
                    isInitialPhase = false;
                    initialTradeCount = 4;
                }
                
                Object.keys(traders).forEach(id => updateTraderDisplay(id));
                updateLeaderboard();
                updateStats();
                
                const elapsed = Date.now() - data.saveTime;
                const elapsedMin = Math.floor(elapsed / 60000);
                const elapsedSec = Math.floor((elapsed % 60000) / 1000);
                
                if (elapsedMin > 0) {
                    console.log(`✅ 数据已恢复 (${elapsedMin}分${elapsedSec}秒前保存)`);
                    showNotification(`✅ 数据已恢复 (${elapsedMin}分钟前保存)`);
                } else {
                    console.log(`✅ 数据已恢复 (${elapsedSec}秒前保存)`);
                    showNotification(`✅ 数据已恢复 (${elapsedSec}秒前)`);
                }
                
                return true;
            } catch (e) {
                console.warn('⚠️ 数据加载失败，将开始新的交易会话:', e.message);
                // 不显示错误通知，静默失败，让用户继续使用
                return false;
            }
        }

        function exportData() {
            try {
                const data = {
                    version: '2.3',
                    exportTime: new Date().toISOString(),
                    traders: traders,
                    priceHistory: priceHistory,
                    initialPrice: initialPrice,
                    currentPrice: currentPrice,
                    startTime: startTime,
                    indicators: indicators,
                    statistics: {
                        totalTrades: Object.values(traders).reduce((sum, t) => sum + t.trades, 0),
                        runtime: Date.now() - startTime,
                        saveCount: saveCount
                    }
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ai_trading_data_${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification('✅ 数据已导出到文件');
                console.log('✅ 数据导出成功');
            } catch (e) {
                console.error('❌ 导出失败:', e);
                showNotification('❌ 导出失败，请重试', 'error');
            }
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const data = JSON.parse(event.target.result);
                    
                    traders = data.traders || traders;
                    
                    Object.keys(traders).forEach(id => {
                        // 兼容旧数据
                        if (traders[id].usdBalance !== undefined) {
                            traders[id].bnbBalance = traders[id].usdBalance;
                            delete traders[id].usdBalance;
                        }
                        if (traders[id].bnbPosition !== undefined && traders[id].positionBNB === undefined) {
                            traders[id].positionBNB = traders[id].bnbPosition;
                            delete traders[id].bnbPosition;
                        }
                        if (traders[id].avgCost !== undefined && traders[id].entryPrice === undefined) {
                            traders[id].entryPrice = traders[id].avgCost;
                            delete traders[id].avgCost;
                        }
                        
                        if (!traders[id].tradeHistory) {
                            traders[id].tradeHistory = [];
                        }
                        if (traders[id].totalVolume === undefined) {
                            traders[id].totalVolume = 0;
                        }
                    });
                    
                    priceHistory = data.priceHistory || [];
                    initialPrice = data.initialPrice || 600;
                    currentPrice = data.currentPrice || 600;
                    startTime = data.startTime || Date.now();
                    indicators = data.indicators || indicators;
                    
                    saveData();
                    Object.keys(traders).forEach(id => updateTraderDisplay(id));
                    updateLeaderboard();
                    updateStats();
                    
                    showNotification('✅ 数据已成功导入');
                    console.log('✅ 数据导入成功');
                } catch (err) {
                    console.error('❌ 导入失败:', err);
                    showNotification('❌ 文件格式错误，请选择正确的JSON文件', 'error');
                }
            };
            reader.readAsText(file);
        });

        function resetData() {
            if (confirm('⚠️ 确定要重置所有数据吗？\n\n这将清除所有交易记录并重新开始。\n（仅清除当前浏览器的数据）')) {
                try {
                    localStorage.removeItem(CONFIG.STORAGE_KEY);
                    console.log('🔄 数据已清除');
                    showNotification('✅ 数据已重置，页面即将刷新...');
                    setTimeout(() => location.reload(), 1500);
                } catch (e) {
                    console.warn('⚠️ 清除数据失败:', e.message);
                    // 即使清除失败也刷新页面，让系统重新初始化
                    setTimeout(() => location.reload(), 1500);
                }
            }
        }

        function togglePause() {
            isPaused = !isPaused;
            const btn = document.getElementById('pauseBtn');
            
            if (isPaused) {
                btn.innerHTML = '<span>▶️</span> 继续';
                btn.classList.add('active');
                document.getElementById('save-status').textContent = '交易已暂停';
                showNotification('⏸️ 交易已暂停');
            } else {
                btn.innerHTML = '<span>⏸️</span> 暂停';
                btn.classList.remove('active');
                document.getElementById('save-status').textContent = '数据自动保存中';
                showNotification('▶️ 交易已继续');
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            if (type === 'error') {
                notification.style.background = 'linear-gradient(135deg, rgba(255, 71, 87, 0.9), rgba(255, 107, 107, 0.9))';
            } else {
                notification.style.background = 'linear-gradient(135deg, rgba(0, 255, 136, 0.9), rgba(0, 200, 100, 0.9))';
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function initChart() {
            new TradingView.widget({
                "width": "100%",
                "height": 400,
                "symbol": "BINANCE:BNBUSDT",
                "interval": "1",
                "timezone": "Asia/Shanghai",
                "theme": "dark",
                "style": "1",
                "locale": "zh_CN",
                "toolbar_bg": "#1a1a1a",
                "enable_publishing": false,
                "hide_side_toolbar": false,
                "allow_symbol_change": false,
                "container_id": "tradingview_chart",
                "studies": ["RSI@tv-basicstudies", "MACD@tv-basicstudies"]
            });
        }

        async function fetchPrice() {
            try {
                const response = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BNBUSDT');
                if (!response.ok) throw new Error('API请求失败');
                const data = await response.json();
                return parseFloat(data.price);
            } catch (error) {
                console.warn('⚠️ 无法获取实时价格，使用模拟价格:', error.message);
                // 使用随机波动模拟价格
                return currentPrice * (1 + (Math.random() - 0.5) * 0.02);
            }
        }

        async function updatePrice() {
            const newPrice = await fetchPrice();
            currentPrice = newPrice;
            
            if (priceHistory.length === 0) {
                initialPrice = currentPrice;
            }
            
            priceHistory.push({
                price: currentPrice,
                time: Date.now()
            });
            
            if (priceHistory.length > 100) {
                priceHistory.shift();
            }
            
            updateIndicators();
            updatePriceDisplay();
            
            Object.keys(traders).forEach(id => updateTraderDisplay(id));
            updateLeaderboard();
            updateStats();
        }

        function updateIndicators() {
            if (priceHistory.length < 14) return;
            
            const prices = priceHistory.map(p => p.price);
            
            let gains = 0, losses = 0;
            for (let i = 1; i < Math.min(14, prices.length); i++) {
                const diff = prices[i] - prices[i-1];
                if (diff > 0) gains += diff;
                else losses -= diff;
            }
            const rs = losses === 0 ? 100 : gains / losses;
            indicators.rsi = Math.round(100 - (100 / (1 + rs)));
            
            const avg = prices.reduce((a,b) => a+b) / prices.length;
            const variance = prices.reduce((sum, p) => sum + Math.pow(p - avg, 2), 0) / prices.length;
            indicators.volatility = (Math.sqrt(variance) / avg * 100).toFixed(1);
            
            if (prices.length >= 26) {
                const recent = prices.slice(-12).reduce((a,b) => a+b) / 12;
                const longer = prices.slice(-26).reduce((a,b) => a+b) / 26;
                indicators.macd = (recent - longer).toFixed(2);
            }
            
            if (currentPrice > avg * 1.02) indicators.trend = 'bullish';
            else if (currentPrice < avg * 0.98) indicators.trend = 'bearish';
            else indicators.trend = 'neutral';
            
            document.getElementById('rsi').textContent = indicators.rsi;
            document.getElementById('macd').textContent = indicators.macd;
            document.getElementById('volatility').textContent = indicators.volatility + '%';
            document.getElementById('volume').textContent = (Math.random() * 2000000).toFixed(0);
            
            let sentiment = '中性';
            if (indicators.rsi > 70) sentiment = '🔥 超买';
            else if (indicators.rsi < 30) sentiment = '❄️ 超卖';
            else if (indicators.trend === 'bullish') sentiment = '📈 看涨';
            else if (indicators.trend === 'bearish') sentiment = '📉 看跌';
            document.getElementById('sentiment').textContent = sentiment;
        }

        function makeTradeDecision(traderId) {
            if (isPaused) return;
            
            const trader = traders[traderId];
            const forceInitialTrade = isInitialPhase && trader.trades === 0;
            
            // 初始阶段强制交易，正常阶段按概率交易
            if (!forceInitialTrade && Math.random() > trader.tradeFreq) return;
            
            let signal = 0;
            let amount = 0;
            let reason = '';
            
            switch(trader.style) {
                case 'conservative':
                    if (forceInitialTrade) {
                        signal = 1;
                        amount = trader.bnbBalance * 0.2;
                        reason = '保守开局建仓';
                    } else if (indicators.rsi < 35 && indicators.trend === 'bearish') {
                        signal = 1;
                        amount = trader.bnbBalance * 0.25;
                        reason = `RSI=${indicators.rsi} 极度超卖抄底`;
                    } else if (indicators.rsi < 45 && indicators.volatility > 2) {
                        signal = 1;
                        amount = trader.bnbBalance * 0.15;
                        reason = `RSI=${indicators.rsi} 高波动超卖`;
                    } else if (indicators.rsi > 65 && trader.positionBNB > 0) {
                        signal = -1;
                        amount = trader.positionBNB * 0.4;
                        reason = `RSI=${indicators.rsi} 超买减仓`;
                    } else if (indicators.rsi > 75 && Math.abs(trader.positionBNB) < 0.01) {
                        signal = -1;
                        amount = trader.bnbBalance * 0.2;
                        reason = `RSI=${indicators.rsi} 极度超买做空`;
                    } else if (indicators.macd > 0.5 && trader.positionBNB > 0) {
                        signal = -1;
                        amount = trader.positionBNB * 0.3;
                        reason = `MACD=${indicators.macd} 技术止盈`;
                    }
                    break;
                    
                case 'aggressive':
                    if (forceInitialTrade) {
                        signal = 1;
                        amount = trader.bnbBalance * 0.5;
                        reason = '激进开局满仓';
                    } else if (indicators.trend === 'bullish' && indicators.rsi < 60) {
                        signal = 1;
                        amount = trader.bnbBalance * 0.6;
                        reason = `趋势向上追涨 RSI=${indicators.rsi}`;
                    } else if (indicators.rsi < 30 && indicators.volatility > 1.5) {
                        signal = 1;
                        amount = trader.bnbBalance * 0.7;
                        reason = `极度超卖抄底 RSI=${indicators.rsi}`;
                    } else if (indicators.trend === 'bearish' && trader.positionBNB > 0) {
                        signal = -1;
                        amount = trader.positionBNB * 0.9;
                        reason = `趋势反转快速止损`;
                    } else if (indicators.trend === 'bearish' && Math.abs(trader.positionBNB) < 0.01) {
                        signal = -1;
                        amount = trader.bnbBalance * 0.5;
                        reason = `趋势下跌激进做空`;
                    } else if (indicators.rsi > 80 && Math.abs(trader.positionBNB) < 0.01) {
                        signal = -1;
                        amount = trader.bnbBalance * 0.6;
                        reason = `极度超买做空 RSI=${indicators.rsi}`;
                    } else if (indicators.macd < -0.3 && trader.positionBNB > 0) {
                        signal = -1;
                        amount = trader.positionBNB * 0.8;
                        reason = `MACD=${indicators.macd} 技术止损`;
                    }
                    break;
                    
                case 'contrarian':
                    if (forceInitialTrade) {
                        signal = 1;
                        amount = trader.bnbBalance * 0.35;
                        reason = '逆向开局建仓';
                    } else if (indicators.rsi > 80 && indicators.volatility > 1) {
                        signal = -1;
                        amount = Math.abs(trader.positionBNB) > 0 ? Math.abs(trader.positionBNB) : trader.bnbBalance * 0.5;
                        reason = `RSI=${indicators.rsi} 极度超买反手做空`;
                    } else if (indicators.rsi < 20 && indicators.volatility > 1) {
                        signal = 1;
                        amount = trader.bnbBalance * 0.5;
                        reason = `RSI=${indicators.rsi} 极度超卖反手抄底`;
                    } else if (indicators.rsi > 70 && trader.positionBNB > 0) {
                        signal = -1;
                        amount = trader.positionBNB * 0.6;
                        reason = `RSI=${indicators.rsi} 超买逆向减仓`;
                    } else if (indicators.rsi < 30 && trader.positionBNB < 0) {
                        signal = 1;
                        amount = Math.abs(trader.positionBNB) * 0.6;
                        reason = `RSI=${indicators.rsi} 超卖逆向平空`;
                    } else if (indicators.macd > 0.8 && Math.abs(trader.positionBNB) < 0.01) {
                        signal = -1;
                        amount = trader.bnbBalance * 0.4;
                        reason = `MACD=${indicators.macd} 技术超买做空`;
                    } else if (indicators.macd < -0.8 && Math.abs(trader.positionBNB) < 0.01) {
                        signal = 1;
                        amount = trader.bnbBalance * 0.4;
                        reason = `MACD=${indicators.macd} 技术超卖抄底`;
                    }
                    break;
                    
                case 'value':
                    if (forceInitialTrade) {
                        signal = 1;
                        amount = trader.bnbBalance * 0.3;
                        reason = '价值开局建仓';
                    } else {
                        const avgPrice = priceHistory.reduce((sum, p) => sum + p.price, 0) / priceHistory.length;
                        const priceDeviation = (currentPrice - avgPrice) / avgPrice;
                        
                        if (currentPrice < avgPrice * 0.94 && indicators.rsi < 40) {
                            signal = 1;
                            amount = trader.bnbBalance * 0.4;
                            reason = `价值低估${(Math.abs(priceDeviation) * 100).toFixed(1)}% 抄底`;
                        } else if (currentPrice < avgPrice * 0.97 && trader.positionBNB < 0) {
                            signal = 1;
                            amount = Math.abs(trader.positionBNB) * 0.5;
                            reason = `价值回归${(Math.abs(priceDeviation) * 100).toFixed(1)}% 平空`;
                        } else if (currentPrice > avgPrice * 1.06 && trader.positionBNB > 0) {
                            signal = -1;
                            amount = trader.positionBNB * 0.3;
                            reason = `价值高估${(priceDeviation * 100).toFixed(1)}% 减仓`;
                        } else if (currentPrice > avgPrice * 1.12 && Math.abs(trader.positionBNB) < 0.01) {
                            signal = -1;
                            amount = trader.bnbBalance * 0.25;
                            reason = `价值高估${(priceDeviation * 100).toFixed(1)}% 做空`;
                        } else if (indicators.volatility > 3 && currentPrice < avgPrice * 0.98) {
                            signal = 1;
                            amount = trader.bnbBalance * 0.2;
                            reason = `高波动价值机会`;
                        } else if (indicators.macd > 0.3 && trader.positionBNB > 0) {
                            signal = -1;
                            amount = trader.positionBNB * 0.2;
                            reason = `MACD=${indicators.macd} 价值止盈`;
                        }
                    }
                    break;
            }
            
            if (signal !== 0 && amount > 0.01) {
                executeTrade(traderId, signal, amount, reason);
                
                if (isInitialPhase) {
                    initialTradeCount++;
                    if (initialTradeCount >= 4) {
                        isInitialPhase = false;
                        console.log('🎬 初始交易完成，进入正常交易模式');
                    }
                }
            }
        }

        function executeTrade(traderId, signal, amount, reason) {
            const trader = traders[traderId];
            const time = new Date().toLocaleTimeString('zh-CN');
            
            // amount是BNB数量
            const bnbAmount = Math.min(amount, trader.bnbBalance);
            if (bnbAmount < 0.001) return;
            
            if (signal === 1) {
                // 做多（或平空）
                if (trader.positionBNB < 0) {
                    // 有空仓，先平仓
                    const closeAmount = Math.min(bnbAmount, Math.abs(trader.positionBNB));
                    
                    // 计算平仓盈亏（BNB）
                    const pnl = closeAmount * (trader.entryPrice - currentPrice) / trader.entryPrice;
                    
                    // 释放保证金 + 盈亏
                    trader.bnbBalance += closeAmount + pnl;
                    trader.positionBNB += closeAmount;
                    
                    if (pnl > 0) trader.wins++;
                    else if (pnl < 0) trader.losses++;
                    
                    const remainAmount = bnbAmount - closeAmount;
                    
                    if (remainAmount > 0.001) {
                        // 剩余开多仓
                        trader.bnbBalance -= remainAmount;
                        trader.positionBNB = remainAmount;
                        trader.entryPrice = currentPrice;
                    } else if (Math.abs(trader.positionBNB) < 0.001) {
                        trader.positionBNB = 0;
                        trader.entryPrice = 0;
                    }
                } else {
                    // 开多仓或加多仓
                    if (trader.positionBNB === 0) {
                        // 开新多仓
                        trader.bnbBalance -= bnbAmount;
                        trader.positionBNB = bnbAmount;
                        trader.entryPrice = currentPrice;
                    } else {
                        // 加多仓
                        const newEntryPrice = ((trader.entryPrice * trader.positionBNB) + 
                                              (currentPrice * bnbAmount)) / (trader.positionBNB + bnbAmount);
                        trader.bnbBalance -= bnbAmount;
                        trader.positionBNB += bnbAmount;
                        trader.entryPrice = newEntryPrice;
                    }
                }
                
                trader.trades++;
                trader.totalVolume += bnbAmount;
                const tradeRecord = {
                    type: 'buy',
                    amount: bnbAmount,
                    price: currentPrice,
                    time: time,
                    reason: reason
                };
                trader.lastTrade = tradeRecord;
                trader.tradeHistory.unshift(tradeRecord);
                
            } else if (signal === -1) {
                // 做空（或平多）
                if (trader.positionBNB > 0) {
                    // 有多仓，先平仓
                    const closeAmount = Math.min(bnbAmount, trader.positionBNB);
                    
                    // 计算平仓盈亏（BNB）
                    const pnl = closeAmount * (currentPrice - trader.entryPrice) / trader.entryPrice;
                    
                    // 释放保证金 + 盈亏
                    trader.bnbBalance += closeAmount + pnl;
                    trader.positionBNB -= closeAmount;
                    
                    if (pnl > 0) trader.wins++;
                    else if (pnl < 0) trader.losses++;
                    
                    const remainAmount = bnbAmount - closeAmount;
                    
                    if (remainAmount > 0.001) {
                        // 剩余开空仓
                        trader.bnbBalance -= remainAmount;
                        trader.positionBNB = -remainAmount;
                        trader.entryPrice = currentPrice;
                    } else if (Math.abs(trader.positionBNB) < 0.001) {
                        trader.positionBNB = 0;
                        trader.entryPrice = 0;
                    }
                } else {
                    // 开空仓或加空仓
                    if (trader.positionBNB === 0) {
                        // 开新空仓
                        trader.bnbBalance -= bnbAmount;
                        trader.positionBNB = -bnbAmount;
                        trader.entryPrice = currentPrice;
                    } else {
                        // 加空仓
                        const oldSize = Math.abs(trader.positionBNB);
                        const newEntryPrice = ((trader.entryPrice * oldSize) + 
                                              (currentPrice * bnbAmount)) / (oldSize + bnbAmount);
                        trader.bnbBalance -= bnbAmount;
                        trader.positionBNB -= bnbAmount;
                        trader.entryPrice = newEntryPrice;
                    }
                }
                
                trader.trades++;
                trader.totalVolume += bnbAmount;
                const tradeRecord = {
                    type: 'sell',
                    amount: bnbAmount,
                    price: currentPrice,
                    time: time,
                    reason: reason
                };
                trader.lastTrade = tradeRecord;
                trader.tradeHistory.unshift(tradeRecord);
            }
            
            if (trader.tradeHistory.length > 20) {
                trader.tradeHistory.pop();
            }
            
            updateTraderDisplay(traderId);
            saveData();
        }

        function updateTraderDisplay(traderId) {
            const trader = traders[traderId];
            
            // 计算未实现盈亏（BNB）
            let unrealizedPnL = 0;
            if (trader.positionBNB !== 0 && trader.entryPrice !== 0) {
                const posSize = Math.abs(trader.positionBNB);
                if (trader.positionBNB > 0) {
                    // 多头：(当前价 - 开仓价) × 持仓量 / 开仓价
                    unrealizedPnL = posSize * (currentPrice - trader.entryPrice) / trader.entryPrice;
                } else {
                    // 空头：(开仓价 - 当前价) × 持仓量 / 开仓价
                    unrealizedPnL = posSize * (trader.entryPrice - currentPrice) / trader.entryPrice;
                }
            }
            
            // 计算总资产（BNB）= BNB余额 + 持仓数量 + 未实现盈亏
            const totalBNB = trader.bnbBalance + Math.abs(trader.positionBNB) + unrealizedPnL;
            const pnl = ((totalBNB - CONFIG.INITIAL_BALANCE) / CONFIG.INITIAL_BALANCE * 100);
            
            // 显示BNB余额
            document.getElementById(`${traderId}-balance`).textContent = trader.bnbBalance.toFixed(4);
            // 显示BNB持仓数量
            document.getElementById(`${traderId}-position`).textContent = Math.abs(trader.positionBNB).toFixed(4);
            document.getElementById(`${traderId}-trades`).textContent = trader.trades;
            
            const winrate = trader.trades > 0 ? (trader.wins / trader.trades * 100) : 0;
            document.getElementById(`${traderId}-winrate`).textContent = winrate.toFixed(0) + '%';
            
            const pnlElement = document.getElementById(`${traderId}-pnl`);
            pnlElement.textContent = (pnl >= 0 ? '+' : '') + pnl.toFixed(2) + '%';
            pnlElement.className = pnl >= 0 ? 'pnl-value profit' : 'pnl-value loss';
            
            // 更新持仓盈亏显示
            const positionPnlBox = document.getElementById(`${traderId}-position-pnl`);
            const unrealizedPnLElement = document.getElementById(`${traderId}-unrealized-pnl`);
            const directionElement = document.getElementById(`${traderId}-direction`);
            
            if (Math.abs(trader.positionBNB) > 0.001) {
                positionPnlBox.style.display = 'block';
                
                // 显示未实现盈亏（BNB）
                unrealizedPnLElement.textContent = (unrealizedPnL >= 0 ? '+' : '') + unrealizedPnL.toFixed(4) + ' BNB';
                unrealizedPnLElement.className = unrealizedPnL >= 0 ? 'profit' : 'loss';
                
                // 显示持仓方向
                if (trader.positionBNB > 0) {
                    positionPnlBox.className = 'position-pnl long';
                    directionElement.textContent = '多头 LONG';
                    directionElement.className = 'position-direction long';
                } else {
                    positionPnlBox.className = 'position-pnl short';
                    directionElement.textContent = '空头 SHORT';
                    directionElement.className = 'position-direction short';
                }
            } else {
                positionPnlBox.style.display = 'none';
            }
            
            // 更新交易历史显示
            const historyElement = document.getElementById(`${traderId}-history`);
            if (trader.tradeHistory.length > 0) {
                const title = `<div class="trade-history-title">交易记录 (${trader.tradeHistory.length})</div>`;
                const trades = trader.tradeHistory.map((trade, index) => {
                    const tradeClass = trade.type === 'buy' ? 'buy-trade' : 'sell-trade';
                    const tradeIcon = trade.type === 'buy' ? '📈' : '📉';
                    const tradeAction = trade.type === 'buy' ? '买入' : '卖出';
                    const isLatest = index === 0;
                    
                    return `
                        <div class="trade-item ${tradeClass}" ${isLatest ? 'style="border-left-width: 5px; background: rgba(255, 255, 255, 0.08);"' : ''}>
                            <div class="trade-time">${trade.time}</div>
                            <div class="trade-info">
                                <strong>${tradeIcon} ${tradeAction}</strong> 
                                ${trade.amount.toFixed(4)} BNB @ $${trade.price.toFixed(2)}
                                <br><span style="color: #aaa; font-size: 10px;">${trade.reason}</span>
                            </div>
                        </div>
                    `;
                }).join('');
                
                historyElement.innerHTML = title + trades;
                historyElement.scrollTop = 0;
            } else {
                historyElement.innerHTML = `
                    <div class="trade-history-title">交易记录 (0)</div>
                    <div style="text-align: center; color: #666; padding: 30px 0; font-style: italic;">
                        <div style="font-size: 24px; margin-bottom: 8px; opacity: 0.5;">⏳</div>
                        <div>等待交易信号...</div>
                        <div style="font-size: 10px; margin-top: 4px; opacity: 0.7;">AI正在分析市场</div>
                    </div>
                `;
            }
        }

        function updatePriceDisplay() {
            const change = ((currentPrice - initialPrice) / initialPrice * 100);
            const changeClass = change >= 0 ? 'price-up' : 'price-down';
            const changeText = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
            
            document.getElementById('header-price').textContent = `$${currentPrice.toFixed(2)}`;
            document.getElementById('header-change').textContent = changeText;
            document.getElementById('header-change').className = `header-value ${changeClass}`;
            
            document.getElementById('chart-price').textContent = `$${currentPrice.toFixed(2)}`;
            document.getElementById('chart-change').textContent = changeText;
            document.getElementById('chart-change').className = `price-change ${changeClass}`;
        }

        function updateLeaderboard() {
            const rankings = Object.keys(traders).map(id => {
                const trader = traders[id];
                
                // 计算未实现盈亏（BNB）
                let unrealizedPnL = 0;
                if (trader.positionBNB !== 0 && trader.entryPrice !== 0) {
                    const posSize = Math.abs(trader.positionBNB);
                    if (trader.positionBNB > 0) {
                        unrealizedPnL = posSize * (currentPrice - trader.entryPrice) / trader.entryPrice;
                    } else {
                        unrealizedPnL = posSize * (trader.entryPrice - currentPrice) / trader.entryPrice;
                    }
                }
                
                const totalBNB = trader.bnbBalance + Math.abs(trader.positionBNB) + unrealizedPnL;
                const pnl = ((totalBNB - CONFIG.INITIAL_BALANCE) / CONFIG.INITIAL_BALANCE * 100);
                return { id, name: trader.name, pnl };
            });
            
            rankings.sort((a, b) => b.pnl - a.pnl);
            
            const leaderboard = document.getElementById('leaderboard');
            leaderboard.innerHTML = rankings.map((r, i) => {
                const rankClass = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
                const pnlClass = r.pnl >= 0 ? 'profit' : 'loss';
                return `
                    <div class="leaderboard-item">
                        <span class="rank ${rankClass}">${i + 1}</span>
                        <span class="leader-name">${r.name}</span>
                        <span class="leader-pnl ${pnlClass}">${r.pnl >= 0 ? '+' : ''}${r.pnl.toFixed(2)}%</span>
                    </div>
                `;
            }).join('');
        }

        function updateStats() {
            const totalTrades = Object.values(traders).reduce((sum, t) => sum + t.trades, 0);
            document.getElementById('stat-trades').textContent = totalTrades;
            
            const avgReturn = Object.values(traders).reduce((sum, t) => {
                let unrealizedPnL = 0;
                if (t.positionBNB !== 0 && t.entryPrice !== 0) {
                    const posSize = Math.abs(t.positionBNB);
                    if (t.positionBNB > 0) {
                        unrealizedPnL = posSize * (currentPrice - t.entryPrice) / t.entryPrice;
                    } else {
                        unrealizedPnL = posSize * (t.entryPrice - currentPrice) / t.entryPrice;
                    }
                }
                
                const totalBNB = t.bnbBalance + Math.abs(t.positionBNB) + unrealizedPnL;
                return sum + ((totalBNB - CONFIG.INITIAL_BALANCE) / CONFIG.INITIAL_BALANCE * 100);
            }, 0) / 4;
            document.getElementById('stat-avg').textContent = 
                (avgReturn >= 0 ? '+' : '') + avgReturn.toFixed(2) + '%';
            
            const maxReturn = Math.max(...Object.values(traders).map(t => {
                let unrealizedPnL = 0;
                if (t.positionBNB !== 0 && t.entryPrice !== 0) {
                    const posSize = Math.abs(t.positionBNB);
                    if (t.positionBNB > 0) {
                        unrealizedPnL = posSize * (currentPrice - t.entryPrice) / t.entryPrice;
                    } else {
                        unrealizedPnL = posSize * (t.entryPrice - currentPrice) / t.entryPrice;
                    }
                }
                
                const totalBNB = t.bnbBalance + Math.abs(t.positionBNB) + unrealizedPnL;
                return ((totalBNB - CONFIG.INITIAL_BALANCE) / CONFIG.INITIAL_BALANCE * 100);
            }));
            document.getElementById('stat-max').textContent = 
                (maxReturn >= 0 ? '+' : '') + maxReturn.toFixed(2) + '%';
            
            const totalVolume = Object.values(traders).reduce((sum, t) => sum + (t.totalVolume || 0), 0);
            document.getElementById('stat-volume').textContent = totalVolume.toFixed(2) + ' BNB';
        }

        function updateRuntime() {
            const runtime = Date.now() - startTime;
            const hours = Math.floor(runtime / 3600000);
            const minutes = Math.floor((runtime % 3600000) / 60000);
            const seconds = Math.floor((runtime % 60000) / 1000);
            
            const timeStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('header-runtime').textContent = timeStr;
            document.getElementById('session-time').textContent = timeStr;
        }

        function tradingLoop() {
            if (isPaused) return;
            
            // 初始阶段：每个AI都有95%概率进行交易决策
            // 正常阶段：每个AI都有60%概率进行交易决策
            const triggerProbability = isInitialPhase ? 0.95 : 0.6;
            
            Object.keys(traders).forEach(traderId => {
                if (Math.random() < triggerProbability) {
                    makeTradeDecision(traderId);
                }
            });
            
            updateLeaderboard();
            updateStats();
        }

        async function init() {
            console.log('🚀 AI Trading Arena v2.3 启动...');
            console.log('💰 每个AI从100 BNB起步，进行1x杠杆合约交易');
            console.log('📊 盈亏计算：持仓量 × (价格变化 / 开仓价) = BNB盈亏');
            
            // 首先确保系统基础初始化
            ensureSystemInitialized();
            
            // 尝试加载数据，失败也没关系
            let hasData = false;
            try {
                hasData = loadData();
                if (hasData) {
                    console.log('✅ 成功加载历史数据');
                } else {
                    console.log('📝 未找到历史数据，使用默认设置');
                }
            } catch (e) {
                console.warn('⚠️ 数据加载失败，使用默认设置:', e.message);
                hasData = false;
            }
            
            // 确保系统正常初始化
            initChart();
            await updatePrice();
            
            // 立即更新UI
            Object.keys(traders).forEach(id => updateTraderDisplay(id));
            updateLeaderboard();
            updateStats();
            
            // 无论是否有历史数据，都确保交易系统启动
            if (!hasData) {
                showNotification('🎉 AI交易竞技场已启动！');
                console.log('💡 初始阶段：AI将快速做出首次交易决策');
                
                // 强制初始交易状态
                isInitialPhase = true;
                initialTradeCount = 0;
            } else {
                showNotification('✅ 已恢复之前的交易会话');
                console.log('✅ 继续之前的交易会话');
                
                // 检查是否需要进入初始阶段
                const allTraded = Object.values(traders).every(t => t.trades > 0);
                if (!allTraded) {
                    isInitialPhase = true;
                    initialTradeCount = Object.values(traders).filter(t => t.trades > 0).length;
                    console.log(`💡 检测到未完成初始交易，继续初始阶段 (${initialTradeCount}/4)`);
                }
            }
            
            // 💥 立即触发交易（不等待），确保用户立刻看到反应
            console.log('🚀 立即触发交易...');
            tradingLoop();
            updateLeaderboard();
            updateStats();
            
            // 极速连续交易 - 快速密集触发，让各个AI都有机会交易
            setTimeout(() => {
                console.log('🚀 触发第2波交易...');
                tradingLoop();
                updateLeaderboard();
                updateStats();
            }, 200);
            
            setTimeout(() => {
                console.log('🚀 触发第3波交易...');
                tradingLoop();
                updateLeaderboard();
                updateStats();
            }, 400);
            
            setTimeout(() => {
                console.log('🚀 触发第4波交易...');
                tradingLoop();
                updateLeaderboard();
                updateStats();
            }, 600);
            
            setTimeout(() => {
                console.log('🚀 触发第5波交易...');
                tradingLoop();
                updateLeaderboard();
                updateStats();
            }, 800);
            
            setInterval(updatePrice, CONFIG.PRICE_UPDATE_INTERVAL);
            setInterval(tradingLoop, CONFIG.TRADE_INTERVAL);
            setInterval(updateRuntime, 1000);
            setInterval(saveData, CONFIG.AUTO_SAVE_INTERVAL);
            
            console.log('✅ 系统启动成功！');
            console.log('💾 数据会自动保存在浏览器本地，每个浏览器独立运行');
        }



        window.addEventListener('load', init);
        window.addEventListener('beforeunload', saveData);
        
        // 全局错误处理，防止崩溃
        window.addEventListener('error', function(e) {
            console.error('⚠️ 发生错误:', e.message);
            // 不显示错误提示，让系统继续运行
        });
    </script>
</body>
</html>
</html>